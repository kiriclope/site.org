<!DOCTYPE html>
<html lang="en">
<head>
<!-- 25 Dec. 2023 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dockerize your Python app</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Alexandre Mahrach">
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-1687066-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-1687066-2');
</script>
<link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css' rel='stylesheet' integrity='crossorigin' anonymous='nil'/>
<meta description='The blog of Alexandre Mahrach'/>
<link rel='alternate' type='application+rss/xml' title='The blog of Alexandre Mahrach' href='posts/rss.xml'/>
<link rel="stylesheet" href="../../css/site.css?v=dfffad2303a13cebe8e9e438d5bc7ec92d5b18b4645dffec15113add46770f42" type="text/css">
</head>
<body>
<header id="preamble" class="status">
<div class="logo">
  <a href="/">
    <img src="/images/photo.png" class="avatar" alt="My photo"/>
  </a>
  <div class="title-section">
    <a href="/"><h1>Alexandre Mahrach</h1></a>
    <!-- <sub style="line-height:1;"> <h2>Data Scientist & Machine Learning Expert</h2> </sub> -->
    <nav>
      <ul>
        <li><a href="/news.html"> News </a></li>
        <li><a href="/posts/archive.html"> Posts </a></li>
        <li><a href="/tutorials/tutorials.html"> Tutorials </a></li>
        <li><a href="/about.html"> About </a></li>
        <!-- add more as needed -->
      </ul>
    </nav>
  </div>
  <div id="social">
    <a title="kiriclope on Github" href="https://github.com/kiriclope">
      <i class="fa-brands fa-github"></i>
    </a>
    <a title="amahrach on LinkedIn" href="https://linkedin.com/in/amahrach">
      <i class="fa-brands fa-linkedin"></i>
    </a>
    <!-- <a title="dmacvicar on Twitter" href="https://twitter.com/dmacvicar"> -->
      <!--   <i class="fa-brands fa-twitter"></i> -->
      <!-- </a> -->
    <a title="RSS feed" id="atom" href="posts/rss.xml">
      <i class="fa-solid fa-rss"></i>
    </a>
  </div>
</div>
</header>
<main id="content">
<header>
<h1 class="title">Dockerize your Python app</h1>
<p class="subtitle">Sep 14, 2023</p>
</header>
<section id="outline-container-org201fe1b" class="outline-2">
<h2 id="org201fe1b">Intro</h2>
<div class="outline-text-2" id="text-org201fe1b">
</div>

<div id="outline-container-orgca2c6d7" class="outline-3">
<h3 id="orgca2c6d7">What is a container?</h3>
<div class="outline-text-3" id="text-orgca2c6d7">
<p>
A container is a sandboxed process running on a host machine that is isolated from all other processes running on that host machine. That isolation leverages kernel namespaces and cgroups, features that have been in Linux for a long time. Docker makes these capabilities approachable and easy to use.
</p>

<ul class="org-ul">
<li>Is a runnable instance of an image. You can create, start, stop, move, or delete a container using the Docker API or CLI.</li>
<li>Can be run on local machines, virtual machines, or deployed to the cloud.</li>
<li>Is portable (and can be run on any OS).</li>
<li>Is isolated from other containers and runs its own software, binaries, configurations, etc.</li>
</ul>

<p>
If you&rsquo;re familiar with chroot, then think of a container as an extended version of chroot. The filesystem comes from the image. However, a container adds additional isolation not available when using chroot.
</p>
</div>
</div>

<div id="outline-container-orgc162609" class="outline-3">
<h3 id="orgc162609">What is an image?</h3>
<div class="outline-text-3" id="text-orgc162609">
<p>
A running container uses an isolated filesystem. This isolated filesystem is provided by an image, and the image must contain everything needed to run an application - all dependencies, configurations, scripts, binaries, etc. The image also contains other configurations for the container, such as environment variables, a default command to run, and other metadata.
</p>
</div>
</div>
<div id="outline-container-org19280e3" class="outline-3">
<h3 id="org19280e3">Installation</h3>
<div class="outline-text-3" id="text-org19280e3">
</div>
<ul class="org-ul">
<li><a id="org28d9573"></a>kvm<br>
<div class="outline-text-5" id="text-org28d9573">
<p>
Docker Desktop runs a VM that requires KVM support
</p>
<div class="org-src-container">
<pre class="src src-sh">modprobe kvm
lsmod | grep kvm
</pre>
</div>

<p>
Set up KVM device user permissions link
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">To check ownership of /dev/kvm</span>
ls -al /dev/kvm
<span class="org-comment-delimiter"># </span><span class="org-comment">Add your user to the kvm group in order to access the kvm device</span>
sudo usermod -aG kvm $<span class="org-variable-name">USER</span>
</pre>
</div>

<p>
Sign out and sign back in so that your group membership is re-evaluated.
</p>
</div>
</li>

<li><a id="org12e72f5"></a>deb<br>
<div class="outline-text-5" id="text-org12e72f5">
<div class="org-src-container">
<pre class="src src-sh">wget
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">sudo apt remove docker-desktop
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">rm -r $<span class="org-variable-name">HOME</span>/.docker/desktop
sudo rm /usr/local/bin/com.docker.cli
sudo apt purge docker-desktop
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">sudo apt-get update
sudo apt-get install ./docker-desktop-&lt;version&gt;-&lt;arch&gt;.deb
</pre>
</div>

<p>
To start Docker Desktop
</p>
<div class="org-src-container">
<pre class="src src-sh">systemctl --user start docker-desktop
</pre>
</div>

<p>
Check the versions of the binaries
</p>
<div class="org-src-container">
<pre class="src src-sh">docker-credential-gcloud compose version
<span class="org-comment-delimiter"># </span><span class="org-comment">Docker Compose version v2.17.3</span>

docker --version
<span class="org-comment-delimiter"># </span><span class="org-comment">Docker version 23.0.5, build bc4487a</span>

docker version
<span class="org-comment-delimiter"># </span><span class="org-comment">Client: Docker Engine - Community</span>
<span class="org-comment-delimiter">#  </span><span class="org-comment">Cloud integration: v1.0.31</span>
<span class="org-comment-delimiter">#  </span><span class="org-comment">Version:           23.0.5</span>
<span class="org-comment-delimiter">#  </span><span class="org-comment">API version:       1.42</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">&lt;...&gt;</span>

</pre>
</div>

<p>
To enable Docker Desktop to start on login
</p>
<div class="org-src-container">
<pre class="src src-sh">systemctl --user enable docker-desktop
</pre>
</div>
</div>
</li>
<li><a id="org780a778"></a>ob-docker<br>
<div class="outline-text-5" id="text-org780a778">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package docker
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:bind</span> (<span class="org-string">"C-c d"</span> . docker))
</pre>
</div>
</div>
</li>
</ul>
</div>
</section>

<section id="outline-container-orgf76a256" class="outline-2">
<h2 id="orgf76a256">Containerize an application</h2>
<div class="outline-text-2" id="text-orgf76a256">
</div>
<div id="outline-container-orge3ae8bc" class="outline-3">
<h3 id="orge3ae8bc">Get the app</h3>
<div class="outline-text-3" id="text-orge3ae8bc">
<p>
Let&rsquo;s say you have the following python repository
</p>
<pre class="example" id="orgf3c2aaf">
├── my_app/
│ ├── main.py
│ ├── README.md
│ ├── test/
│ ├── src/
│ └── requirements.txt
</pre>
</div>
</div>

<div id="outline-container-org8b267bb" class="outline-3">
<h3 id="org8b267bb">Build an image</h3>
<div class="outline-text-3" id="text-org8b267bb">
</div>
<ul class="org-ul">
<li><a id="orgdd1062c"></a>Create a <code>Dockerfile</code><br>
<div class="outline-text-5" id="text-orgdd1062c">
<p>
To build the image, you&rsquo;ll need to use a Dockerfile. A Dockerfile is simply a text-based file with no file extension that contains a script of instructions. Docker uses this script to build a container image.
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">cd</span> /path/to/my_app
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">touch Dockerfile
</pre>
</div>

<div class="org-src-container">
<pre class="src src-docker-build">FROM python:3.8-alpine
# Or any preferred Python version.
ADD main.py .
RUN pip install requests beautifulsoup4 python-dotenv
CMD [“python”, “./main.py”]
# Or enter the name of your unique directory and parameter set.
</pre>
</div>

<p>
This Dockerfileis fairly basic, which is perfect for this application. Your <code>Dockerfile</code> will change depending on your code and desired app functionality. There are also other arguments available, like <code>WORKDIR, ENV, COPY, EXPOSE, ENTRYPOINT and HEALTHCHECK</code>. Each allows you to build more operative complexity into your Python applications, or control which resources are pulled in.
</p>
</div>
</li>

<li><a id="orgf697c4c"></a>build<br>
<div class="outline-text-5" id="text-orgf697c4c">
<p>
The <code>docker build</code> command uses the Dockerfile to build a new image.
</p>

<div class="org-src-container">
<pre class="src src-sh">docker build -t my_app .
</pre>
</div>

<p>
The docker build command uses the Dockerfile to build a new image. You might have noticed that Docker downloaded a lot of &ldquo;layers&rdquo;. This is because you instructed the builder that you wanted to start from the <code>python:3.8-alpine</code> image. But, since you didn&rsquo;t have that on your machine, Docker needed to download the image.
</p>

<p>
After Docker downloaded the image, the instructions from the Dockerfile copied in your application and used <code>pip</code> to install your application&rsquo;s dependencies. The <code>CMD</code> directive specifies the default command to run when starting a container from this image.
</p>

<p>
Finally, the <code>-t</code> flag tags your image. Think of this as a human-readable name for the final image. Since you named the image getting-started, you can refer to that image when you run a container.
</p>

<p>
The <code>.</code> at the end of the <code>docker build</code> command tells Docker that it should look for the <code>Dockerfile</code> in the current directory.
</p>
</div>
</li>
</ul>
</div>

<div id="outline-container-org1da275d" class="outline-3">
<h3 id="org1da275d">run an image</h3>
<div class="outline-text-3" id="text-org1da275d">
<p>
Now that you have an image, you can run the application in a container using the <code>docker run</code> command.
</p>
<div class="org-src-container">
<pre class="src src-sh">docker run -dp 127.0.0.1:3000:3000 my_app
</pre>
</div>

<p>
The <code>-d</code> flag (short for <code>--detach</code>) runs the container in the background. The <code>-p</code> flag (short for <code>--publish</code>) creates a port mapping between the host and the container. The <code>-p</code> flag takes a string value in the format of <code>HOST:CONTAINER</code>, where <code>HOST</code> is the address on the host, and <code>CONTAINER</code> is the port on the container. The command publishes the container&rsquo;s port <code>3000</code> to <code>127.0.0.1:3000</code> (<code>localhost:3000</code>) on the host. Without the port mapping, you wouldn&rsquo;t be able to access the application from the host.
</p>

<p>
After a few seconds, open your web browser to <a href="http://localhost:3000">http://localhost:3000</a>. You should see your app.
</p>

<p>
If you take a quick look at your containers, you should see at least one container running that&rsquo;s using the <code>my_app</code> image and on port <code>3000</code>. To see your containers, you can use the <code>CLI</code> or Docker Desktop&rsquo;s graphical interface.
</p>

<div class="org-src-container">
<pre class="src src-sh">docker ps
</pre>
</div>

<pre class="example" id="orgd836589">
CONTAINER ID   IMAGE    COMMAND                  CREATED             STATUS        PORTS                     NAMES
df784548666d   my_app   "docker-entrypoint.s…"   2 minutes ago       Up 2 minutes  127.0.0.1:3000-&gt;3000/tcp  kiriclope
</pre>
</div>
</div>
</section>

<section id="outline-container-org6b2a961" class="outline-2">
<h2 id="org6b2a961">References</h2>
<div class="outline-text-2" id="text-org6b2a961">
<ul class="org-ul">
<li><a href="https://www.docker.com/">Docker</a></li>
<li><a href="https://docs.docker.com/engine/reference/builder/">Dockerfile reference</a></li>
<li><a href="https://docs.docker.com/engine/reference/commandline/cli/">docker cli reference</a></li>
<li><a href="https://docs.docker.com/build/guide/">Build with Docker guide</a></li>
</ul>
</div>
</section>
</main>
<footer id="postamble" class="status">
<p>Last updated 25 Dec. 2023. Built with <a href="https://www.gnu.org/software/emacs/">Emacs</a> 27.2 (<a href="https://orgmode.org">Org</a> mode 9.4.4). <a href="/README.html">Details</a>.</p>
</footer>
</body>
</html>
